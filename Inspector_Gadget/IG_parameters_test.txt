# Parameters for Inspector Gadget
# Can be changed arbitrarily after Gadget-2 run.
# Have nothing to do with Gadget-2 run itself, just with output processing.
# Keywords in arbitrary order, but care sensitive.
# No spaces within keywords allowed.
# Feedback will not start until feedback keyword is read,
# thus if you wish feedback for read-in of parameters, place this keyword first.


### Condor Paths: ###

Parameter_path .  # always keep this way and pu parameter file in same folder as executable.

# Comoving_file IG_comoving.txt   # (Hardcoded) Name of file listing comoving distances. Has to be in folder where the original N-body snapshots are.
# Inspector_parameterfile IG_parameters.txt # Parameter file (this file), has to be named "IG_parameters.txt" (hardcoded) and in same folder as the Inspector Gadget executable.

### File names: ###

Snapshot_name snapshot
Density_basename dens
Potential_basename pot

Map_basename WL-
Convergence_basename conv
Shear1_basename	     shear1
Shear2_basename shear2
Omega_basename omega
Shear_modulus_basename shear_abs
Shear_angle_basename shear_ang
Deflection1_basename defl1
Deflection2_basename defl2
Deflection_total_basename defl_total
Deflection_angle_basename defl_ang

### Comments: ###
# Enter brief comments here to be included in FITS header.
# Use underscores instead of blanks.
Plane_comment (none)
WL_map_comment (none)


### Parameters: ###


### Useful parameters: ###

Feedback -1
nx 256   # 4096   #  2048                     # Number of grid points on 2D lens planes, 2048 is a good choice for high resolution maps.
ny 256   # 4096   #  2048                     # Number of grid points on 2D lens planes.
NbinsX 128 # 2048                 # Number of bins (pixels in 1 dimension) for weak lensing analysis.
NbinsY 128 # 2048                 # Number of bins (pixels in 1 dimension) for weak lensing analysis.
# Obsolete:
Seed 1

########################################################################


### Unusual parameters (typically not to be changed): ###
Species 1                  # 0: gas (SPH), 1: dark matter (halo). So far only 1 used and tested.
Scramble_mode 2            # 0: No box rotations or shifts, 1: simple random number (does not work well when code is run parallel), 2: random numbers from prefabricated list (up to 1000 realizations possible). Default is 2.
Plane_shift 1 # Shifts planes transversally (with periodic completion) before ray-tracing, causing additional randomization. Set to 1 when using minimal number of planes. (Depreciated parameter (set to zero) for IG3 and IG4, but used again since IG5.)
Ray_tracing 1              # Ray-tracing is on if !=0. Default is 1 (on).
Cell_embedding 2     # Particles on Grid: 1: Cloud-in-cell, 2: TSC. Best is TSC.
Raypoint_averaging 3 # 1: for linear averaging, 2: for bicubic averaging, 3 (and everything else): for TSC averaging over derivative values on grid. 
Convergence_direct 0  # If !=0, calculate convergence directly from density planes (for testing mostly, default is 0 for this parameter).

### Unusual parameters (typically automatically set by code from sim): ###
Plane_padding 0 #0.05          # 0 is no padding, i.e. exact size visible by survey, 1.0 is size of survey (extra half on each side), etc.


### MPI Parameters:
# (Ignored (resp overwritten) if used with condor):

Mode 2 (1: Potential Planes, 2: WL Maps) 
First_snapshot 0   # 0 
Last_snapshot 58    # 58 
First_realization 1  # 1 # for Mode 1 always start at 1. Mode 2 not sure non-1 value works.
Last_realization 4 # mode1: set to 9, mode2: set to 1-4 (or similar) #  1000 # 40   # 250  # 200
Seed_block 9         # 10 is a good value for 1GB memory / CPU on NYBlue/P (i.e. DUAL mode) and nx=2048, 3 for nx=4096 on NYBlue/P and DUAL mode (2 on NYBlue/L and CO mode). 8 for nx=4096 and SMP mode (NYBlue/P only).
Max_realizations 1000 # maximum number of realizations allowed during ray-tracing, before random numbers repeat between different subfields.
Preload_planes 1 # 0: read in potential planes as needed for each map, 1: preload all potential planes at the beginning of the run (into an RMA window) 
Number_of_plane_realizations 9 # This can be later automatized from random plane drawing file.
Number_of_sim_ics 2 # 5 # This can be later automatized from random plane drawing file.
First_sim_ic 1 # count starts at 1. First N-body simulation IC used.


Snapskip 1   # 1 # How many snapshot boxes will be skipped between planes (1 if no skip) (2 for j-series of simulations, 1 for the more modern i-series and m-series)
Fiducial 0  # For Mode=2:  Submitted cosmologies beyond this number treated as nonfiducial models, cosmologies lower or equal to this number are fiducial (more ICs, fewer plane realizations per IC). Count starts at 1. Set to zero if all are nonfiducial. # Probably depreciated parameter; keep set to zero.

# Paths for files to be used during MPI submission:
Snapshot_path ../Storage/sims/snapshots/mQ2-series # /gpfs/scratch3/jank/Storage/sims/snapshots/m-series  # path from which Gadget-2 snapshots are read in.
Plane_output_path ../Storage/wl/IG/mQ2-series # /gpfs/scratch1/jank/Storage/wl/IG/m-series   # path where density and potential planes are written to after TSC insertion.
Plane_path ../Storage/wl/IG/mQ2-series # /gpfs/scratch1/jank/Storage/wl/IG/m-series   # path from which potential planes are read for WL map generation (typically same as Plane_output_path).
Map_output_path ../Storage/wl/IG/mQ2-series # /gpfs/scratch2/jank/Storage/wl/IG/m-series   # path where WL maps are written to.
Planes_folder Planes
Maps_folder Maps_debug_OMP_preload

####### Galaxy Catalogue: ###########
Galaxy_catalogue_type 0 # 0: Maps with source redshift plane, 1: galaxy catalogue (with galaxies at various redshifts, and angular galaxy positions in radians from map center).
Galaxy_catalogue_path ./galaxy_catalogue_debug
Galaxy_catalogue_output_path ./galaxy_catalogue_debug
Galaxy_catalogue_basename galaxy_catalogue_128fakemap # excludes file number.
Galaxy_subfield 1 # count starts at 1; e.g. the 13 CFHT subfields for our map sizes from the CFHT survey.

####### Snapshot Rotations and Lens Plane Shifts (enter full paths including filename): ######## 
Snapshot_rotation_randomizer_file ./IG_random_numbers.txt
Plane_randomizer_file_general ./IG_RandomPlanes_general_minimalplanetest.txt
Plane_randomizer_file_fiducial ./IG_RandomPlanes_fiducial_minimalplanetest.txt
# Note: the fiducial option above may not work anymore.


############# Source Parameters (since Inspector Gadget 5) #################
Source_redshift 2.0
Plane_before_source 50 # 46
Survey_angle 0.2125  # 3.4641 # If set to zero, automatically determined by code (typically set manually, so all cosmologies get maps of same angular size).

# Settings for m-series and mQ3-series:
#
# Source_redshift 1.0
# Plane_before_source 29
# Survey_angle 3.4641  # 4.55 = maximal angle at z=1 for a 200Mpc/h sim.
#
# Source_redshift 1.5
# Plane_before_source 38
# Survey_angle 3.4641  # 3.41 = maximal angle at z=1.5 for a 200Mpc/h sim.
#
# Source_redshift 2.0
# Plane_before_source 46
# Survey_angle 3.4641  # 3.4641 is 12 sq. degrees, maximal angle for 240Mpc/h sim is 3.51337764326 (but a little border needs to be left for light bending of the order of 1-2 arcminutes)  # 2.86 = maximal angle at z=2 for a 200Mpc/h sim.
#
# Source_redshift 2.5
# Plane_before_source 52
# Survey_angle 2.53
#
# Source_redshift 3.0
# Plane_before_source 57
# Survey_angle 2.32
#
# For small test fields on laptop (32^3 particles, 15Mpc/h boxsize):
# Survey_angle 0.2125


### Note for MPI: Further parameters to be adjusted are in mpi_support.c ! ###
### Note for MPI: To compile with MPI, also need to set compilation macro MPI_COMPILE to 1 in main.h ! ###
